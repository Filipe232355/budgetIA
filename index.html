<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget IA - Orçamentos Automatizados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
        }
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .sidebar-item:hover {
            background-color: rgba(16, 185, 129, 0.1);
        }
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%);
            border-left: 3px solid linear-gradient(90deg, #10b981 0%, #06b6d4 100%);
        }
        .btn-gradient {
            background: linear-gradient(90deg, #10b981 0%, #06b6d4 100%);
        }
        .btn-gradient:hover {
            background: linear-gradient(90deg, #0d9e76 0%, #0891b2 100%);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .budget-logo {
            background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .drag-over {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.05);
        }
        .service-selector {
            max-height: 200px;
            overflow-y: auto;
        }
        .clickable-activity {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .clickable-activity:hover {
            background-color: rgba(16, 185, 129, 0.05);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Login Screen (Default View) -->
        <div id="login-screen" class="flex flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-md bg-white rounded-xl shadow-md p-8 fade-in">
                <div class="flex flex-col items-center mb-8">
                    <div class="budget-logo flex items-center justify-center rounded-2xl w-16 h-16 mb-4 relative">
                        <i data-lucide="zap" class="text-white w-6 h-6 absolute top-2 left-2"></i>
                        <i data-lucide="calculator" class="text-white w-4 h-4 absolute bottom-2 right-2 opacity-80"></i>
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">Budget IA</h1>
                    <p class="text-gray-500 mt-1">Orçamentos automatizados via WhatsApp</p>
                </div>
                
                <form class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">E-mail</label>
                        <input type="email" id="email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Senha</label>
                        <input type="password" id="password" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input id="remember-me" type="checkbox" class="h-4 w-4 text-[#25D366] focus:ring-[#25D366] border-gray-300 rounded">
                            <label for="remember-me" class="ml-2 block text-sm text-gray-700">Lembrar-me</label>
                        </div>
                        <a href="#" onclick="showForgotPassword()" class="text-sm text-[#25D366] hover:underline">Esqueci minha senha</a>
                    </div>
                    
                    <button type="button" onclick="showDashboard()" class="w-full bg-[#25D366] text-white py-2 px-4 rounded-lg font-medium hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366] transition shadow-sm">
                        Entrar
                    </button>
                    
                    <div class="text-center text-sm text-gray-600">
                        Não tem uma conta? <a href="#" onclick="showRegister()" class="text-[#25D366] hover:underline">Crie agora</a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Forgot Password Screen -->
        <div id="forgot-password-screen" class="hidden flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-md bg-white rounded-xl shadow-md p-8 fade-in">
                <div class="flex flex-col items-center mb-8">
                    <div class="flex items-center justify-center bg-[#25D366] rounded-full w-16 h-16 mb-4">
                        <i data-lucide="key" class="text-white w-8 h-8"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Recuperar senha</h1>
                    <p class="text-gray-500 mt-1">Digite seu e-mail para redefinir sua senha</p>
                </div>
                
                <form class="space-y-4">
                    <div>
                        <label for="recovery-email" class="block text-sm font-medium text-gray-700">E-mail</label>
                        <input type="email" id="recovery-email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <button type="button" onclick="showLogin()" class="w-full bg-[#25D366] text-white py-2 px-4 rounded-lg font-medium hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366] transition shadow-sm">
                        Enviar link de recuperação
                    </button>
                    
                    <div class="text-center text-sm text-gray-600">
                        <a href="#" onclick="showLogin()" class="text-[#25D366] hover:underline">Voltar para o login</a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Register Screen -->
        <div id="register-screen" class="hidden flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-md bg-white rounded-xl shadow-md p-8 fade-in">
                <div class="flex flex-col items-center mb-8">
                    <div class="flex items-center justify-center bg-[#25D366] rounded-full w-16 h-16 mb-4">
                        <i data-lucide="user-plus" class="text-white w-8 h-8"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Criar conta</h1>
                    <p class="text-gray-500 mt-1">Preencha seus dados para começar</p>
                </div>
                
                <form class="space-y-4">
                    <div>
                        <label for="full-name" class="block text-sm font-medium text-gray-700">Nome completo</label>
                        <input type="text" id="full-name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <div>
                        <label for="register-email" class="block text-sm font-medium text-gray-700">E-mail</label>
                        <input type="email" id="register-email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <div>
                        <label for="register-password" class="block text-sm font-medium text-gray-700">Senha</label>
                        <input type="password" id="register-password" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <div>
                        <label for="confirm-password" class="block text-sm font-medium text-gray-700">Confirmar senha</label>
                        <input type="password" id="confirm-password" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                    </div>
                    
                    <button type="button" onclick="showDashboard()" class="w-full bg-[#25D366] text-white py-2 px-4 rounded-lg font-medium hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366] transition shadow-sm">
                        Criar conta
                    </button>
                    
                    <div class="text-center text-sm text-gray-600">
                        Já tem uma conta? <a href="#" onclick="showLogin()" class="text-[#25D366] hover:underline">Faça login</a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Dashboard -->
        <div id="dashboard" class="hidden min-h-screen">
            <!-- Sidebar -->
            <div class="fixed inset-y-0 left-0 w-64 bg-white shadow-md z-10 hidden md:block">
                <div class="flex items-center justify-center h-16 px-4 border-b">
                    <div class="flex items-center">
                        <div class="budget-logo flex items-center justify-center rounded-xl w-10 h-10 mr-3 relative">
                            <i data-lucide="zap" class="text-white w-5 h-5 absolute top-1 left-1"></i>
                            <i data-lucide="calculator" class="text-white w-3 h-3 absolute bottom-1 right-1 opacity-80"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-lg font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">Budget IA</span>
                            <span class="text-xs text-gray-500 font-medium">Orçamentos Inteligentes</span>
                        </div>
                    </div>
                </div>
                
                <div class="px-4 py-4">
                    <div class="flex items-center px-4 py-3 bg-gray-100 rounded-lg">
                        <div class="flex-shrink-0">
                            <div class="flex items-center justify-center bg-[#25D366] rounded-full w-10 h-10">
                                <i data-lucide="user" class="text-white w-5 h-5"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">João Silva</p>
                            <p class="text-xs text-gray-500">admin@budgetia.com</p>
                        </div>
                    </div>
                </div>
                
                <nav class="mt-2 px-2 space-y-1">
                    <a href="#" onclick="showDashboardHome()" class="sidebar-item active flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="home">
                        <i data-lucide="home" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Home
                    </a>
                    <a href="#" onclick="showConnectWhatsApp()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="whatsapp">
                        <i data-lucide="message-square" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Conectar WhatsApp
                    </a>
                    <a href="#" onclick="showGenerateBudget()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="budget">
                        <i data-lucide="file-text" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Gerar Orçamento
                    </a>
                    <a href="#" onclick="showServicesManagement()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="services">
                        <i data-lucide="briefcase" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Gerenciar Serviços
                    </a>
                    <a href="#" onclick="showPDFTemplates()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="pdf">
                        <i data-lucide="file-template" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Modelos de PDF
                    </a>
                    <a href="#" onclick="showTestBot()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="test">
                        <i data-lucide="send" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Enviar Mensagem
                    </a>
                    <a href="#" onclick="showAISettings()" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg" data-page="settings">
                        <i data-lucide="settings" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Configurações
                    </a>
                </nav>
                
                <div class="absolute bottom-0 left-0 right-0 p-4 border-t">
                    <button onclick="showLogin()" class="flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="log-out" class="w-5 h-5 mr-3 text-gray-500"></i>
                        Sair
                    </button>
                </div>
            </div>
            
            <!-- Mobile Sidebar -->
            <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg z-10">
                <div class="flex justify-around">
                    <a href="#" onclick="showDashboardHome()" class="flex flex-col items-center justify-center p-2 text-xs text-[#25D366]">
                        <i data-lucide="home" class="w-4 h-4 mb-1"></i>
                        Home
                    </a>
                    <a href="#" onclick="showConnectWhatsApp()" class="flex flex-col items-center justify-center p-2 text-xs text-gray-500">
                        <i data-lucide="message-square" class="w-4 h-4 mb-1"></i>
                        WhatsApp
                    </a>
                    <a href="#" onclick="showGenerateBudget()" class="flex flex-col items-center justify-center p-2 text-xs text-gray-500">
                        <i data-lucide="file-text" class="w-4 h-4 mb-1"></i>
                        Orçamento
                    </a>
                    <a href="#" onclick="showServicesManagement()" class="flex flex-col items-center justify-center p-2 text-xs text-gray-500">
                        <i data-lucide="briefcase" class="w-4 h-4 mb-1"></i>
                        Serviços
                    </a>
                    <a href="#" onclick="showPDFTemplates()" class="flex flex-col items-center justify-center p-2 text-xs text-gray-500">
                        <i data-lucide="file-template" class="w-4 h-4 mb-1"></i>
                        PDF
                    </a>
                    <a href="#" onclick="showAISettings()" class="flex flex-col items-center justify-center p-2 text-xs text-gray-500">
                        <i data-lucide="settings" class="w-4 h-4 mb-1"></i>
                        Config
                    </a>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="md:ml-64 pb-16 md:pb-0">
                <!-- Header -->
                <header class="bg-white shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
                        <div class="flex items-center md:hidden">
                            <button class="mr-2 text-gray-500">
                                <i data-lucide="menu" class="w-6 h-6"></i>
                            </button>
                            <div class="flex items-center">
                                <div class="budget-logo flex items-center justify-center rounded-xl w-8 h-8 mr-2 relative">
                                    <i data-lucide="zap" class="text-white w-4 h-4 absolute top-0 left-0"></i>
                                    <i data-lucide="calculator" class="text-white w-2 h-2 absolute bottom-0 right-0 opacity-80"></i>
                                </div>
                                <span class="text-lg font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">Budget IA</span>
                            </div>
                        </div>
                        
                        <div class="hidden md:block">
                            <h1 class="text-lg font-medium text-gray-900" id="dashboard-title">Dashboard</h1>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center bg-gray-200 rounded-full w-8 h-8 md:w-10 md:h-10">
                                    <i data-lucide="user" class="text-gray-600 w-4 h-4 md:w-5 md:h-5"></i>
                                </div>
                                <span class="ml-2 text-sm font-medium text-gray-700 hidden md:inline">João Silva</span>
                            </div>
                        </div>
                    </div>
                </header>
                
                <!-- Dashboard Home -->
                <main id="dashboard-home" class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">Bem-vindo ao Budget IA</h2>
                        <p class="text-gray-600 mt-1">Gerencie seus orçamentos automatizados via WhatsApp</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-100 transition duration-300">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center bg-green-100 rounded-full w-12 h-12">
                                    <i data-lucide="message-square" class="text-[#25D366] w-5 h-5"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500">Mensagens hoje</p>
                                    <p class="text-xl font-semibold text-gray-800">24</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-100 transition duration-300">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center bg-blue-100 rounded-full w-12 h-12">
                                    <i data-lucide="file-text" class="text-blue-500 w-5 h-5"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500">Orçamentos</p>
                                    <p class="text-xl font-semibold text-gray-800">15</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-100 transition duration-300">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center bg-purple-100 rounded-full w-12 h-12">
                                    <i data-lucide="users" class="text-purple-500 w-5 h-5"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500">Clientes</p>
                                    <p class="text-xl font-semibold text-gray-800">42</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white p-6 rounded-xl shadow-sm border border-gray-100 transition duration-300">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center bg-yellow-100 rounded-full w-12 h-12">
                                    <i data-lucide="zap" class="text-yellow-500 w-5 h-5"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500">Status</p>
                                    <div class="flex items-center">
                                        <span class="h-2 w-2 rounded-full bg-[#25D366] mr-2"></span>
                                        <p class="text-sm font-medium text-gray-800">Conectado</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-medium text-gray-800">Atividades recentes</h3>
                                <a href="#" class="text-sm text-[#25D366] hover:underline">Ver todas</a>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-start clickable-activity p-2 rounded-lg" onclick="viewBudgetDetail(1)">
                                    <div class="flex-shrink-0">
                                        <div class="flex items-center justify-center bg-green-100 rounded-full w-10 h-10">
                                            <i data-lucide="message-square" class="text-[#25D366] w-4 h-4"></i>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-800">Novo orçamento enviado</p>
                                        <p class="text-sm text-gray-500">Para: Cliente A • 10 min atrás</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start clickable-activity p-2 rounded-lg" onclick="viewBudgetDetail(2)">
                                    <div class="flex-shrink-0">
                                        <div class="flex items-center justify-center bg-blue-100 rounded-full w-10 h-10">
                                            <i data-lucide="file-text" class="text-blue-500 w-4 h-4"></i>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-800">Orçamento aprovado</p>
                                        <p class="text-sm text-gray-500">Por: Cliente B • 1 hora atrás</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start clickable-activity p-2 rounded-lg" onclick="viewBudgetDetail(3)">
                                    <div class="flex-shrink-0">
                                        <div class="flex items-center justify-center bg-purple-100 rounded-full w-10 h-10">
                                            <i data-lucide="user-plus" class="text-purple-500 w-4 h-4"></i>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-800">Novo cliente cadastrado</p>
                                        <p class="text-sm text-gray-500">Cliente C • 2 horas atrás</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-medium text-gray-800">Orçamentos recentes</h3>
                                <a href="#" class="text-sm text-[#25D366] hover:underline">Ver todos</a>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr class="clickable-activity" onclick="viewBudgetDetail(1)">
                                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-800">Cliente A</td>
                                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">R$ 1.200,00</td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Aprovado</span>
                                            </td>
                                        </tr>
                                        <tr class="clickable-activity" onclick="viewBudgetDetail(2)">
                                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-800">Cliente B</td>
                                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">R$ 850,00</td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Pendente</span>
                                            </td>
                                        </tr>
                                        <tr class="clickable-activity" onclick="viewBudgetDetail(3)">
                                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-800">Cliente C</td>
                                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">R$ 2.500,00</td>
                                            <td class="px-4 py-3 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Recusado</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>

                <!-- Budget Detail View -->
                <main id="budget-detail" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center">
                                <button onclick="showDashboardHome()" class="mr-4 text-gray-500 hover:text-gray-700">
                                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                </button>
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-800">Detalhes do Orçamento</h2>
                                    <p class="text-gray-600 mt-1">Visualização completa do orçamento</p>
                                </div>
                            </div>
                            <button onclick="viewBudgetPDF()" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 transition">
                                <i data-lucide="file-text" class="w-4 h-4 mr-2 inline"></i>
                                Ver PDF
                            </button>
                        </div>

                        <div id="budget-detail-content" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                </main>
                
                <!-- Connect WhatsApp -->
                <main id="connect-whatsapp" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Conectar WhatsApp</h2>
                            <p class="text-gray-600 mt-1">Conecte sua conta do WhatsApp para começar a enviar orçamentos automatizados</p>
                        </div>
                        
                        <div class="flex flex-col items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-xl">
                            <div class="bg-gray-100 p-4 rounded-lg mb-6">
                                <div class="bg-white p-4 rounded">
                                    <div class="flex justify-center">
                                        <div class="w-48 h-48 bg-gray-200 flex items-center justify-center rounded">
                                            <i data-lucide="qr-code" class="w-16 h-16 text-gray-400"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center mb-6">
                                <div class="h-2 w-2 rounded-full bg-[#25D366] mr-2"></div>
                                <p class="text-sm font-medium text-gray-800">Status: Conectado</p>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button class="flex items-center justify-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[#25D366] hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                    Gerar QR Code
                                </button>
                                <button class="flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                    <i data-lucide="link" class="w-4 h-4 mr-2"></i>
                                    Reconectar
                                </button>
                            </div>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-lg font-medium text-gray-800 mb-3">Instruções</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-600">
                                <li>Clique em "Gerar QR Code" para exibir o código QR</li>
                                <li>Abra o WhatsApp no seu celular</li>
                                <li>Toque em <strong>Menu → Dispositivos conectados → Conectar um dispositivo</strong></li>
                                <li>Aponte a câmera do seu celular para o código QR acima</li>
                                <li>Pronto! Seu WhatsApp está conectado ao Budget IA</li>
                            </ol>
                        </div>
                    </div>
                </main>
                
                <!-- Generate Budget -->
                <main id="generate-budget" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Gerar Orçamento</h2>
                            <p class="text-gray-600 mt-1">Preencha os dados para criar um novo orçamento</p>
                        </div>
                        
                        <form class="space-y-6">
                            <div>
                                <label for="client-name" class="block text-sm font-medium text-gray-700">Nome do cliente</label>
                                <input type="text" id="client-name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                            </div>
                            
                            <div>
                                <label for="client-phone" class="block text-sm font-medium text-gray-700">WhatsApp do cliente</label>
                                <div class="mt-1 flex rounded-lg shadow-sm">
                                    <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">+55</span>
                                    <input type="tel" id="client-phone" class="flex-1 block w-full px-4 py-2 rounded-none rounded-r-lg border border-gray-300 focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                                </div>
                            </div>

                            <div>
                                <label for="client-email" class="block text-sm font-medium text-gray-700">E-mail do cliente</label>
                                <input type="email" id="client-email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                            </div>

                            <div>
                                <label for="client-address" class="block text-sm font-medium text-gray-700">Endereço do cliente</label>
                                <input type="text" id="client-address" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Serviços</label>
                                <div class="border border-gray-300 rounded-lg p-4">
                                    <div class="mb-4">
                                        <button type="button" onclick="openServiceSelector()" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                            <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
                                            Selecionar Serviços
                                        </button>
                                    </div>
                                    <div id="selected-services-container" class="space-y-3">
                                        <!-- Selected services will appear here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="expiration" class="block text-sm font-medium text-gray-700">Validade do orçamento</label>
                                <input type="date" id="expiration" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                                <p class="mt-1 text-xs text-gray-500">Se não preenchido, será definido automaticamente para 10 dias a partir de hoje</p>
                            </div>
                            
                            <div>
                                <label for="notes" class="block text-sm font-medium text-gray-700">Observações</label>
                                <textarea id="notes" rows="3" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition"></textarea>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                    Cancelar
                                </button>
                                <button type="button" onclick="generatePDF()" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-400 transition">
                                    <i data-lucide="file-text" class="w-4 h-4 mr-1 inline"></i>
                                    Gerar PDF
                                </button>
                                <button type="button" onclick="downloadPDF()" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition">
                                    <i data-lucide="download" class="w-4 h-4 mr-1 inline"></i>
                                    Baixar PDF
                                </button>
                                <button type="button" onclick="shareWhatsApp()" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[#075E54] hover:bg-[#064D45] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#075E54] transition">
                                    <i data-lucide="share-2" class="w-4 h-4 mr-1 inline"></i>
                                    Compartilhar PDF
                                </button>
                            </div>
                        </form>
                    </div>
                </main>
                
                <!-- Services Management -->
                <main id="services-management" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-xl font-semibold text-gray-800">Gerenciar Serviços</h2>
                                <p class="text-gray-600 mt-1">Cadastre e organize seus serviços</p>
                            </div>
                            <button onclick="openNewServiceModal()" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-400 transition shadow-sm">
                                <i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>
                                Novo Serviço
                            </button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="services-list">
                                    <!-- Services will be listed here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Empty state -->
                        <div id="services-empty-state" class="text-center py-12">
                            <div class="text-gray-400 mb-4">
                                <i data-lucide="briefcase" class="w-16 h-16 mx-auto"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum serviço cadastrado</h3>
                            <p class="text-gray-500 mb-4">Comece adicionando seu primeiro serviço</p>
                            <button onclick="openNewServiceModal()" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 transition">
                                <i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>
                                Adicionar Serviço
                            </button>
                        </div>
                    </div>
                </main>

                <!-- PDF Templates -->
                <main id="pdf-templates" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Modelos de PDF</h2>
                            <p class="text-gray-600 mt-1">Gerencie seus modelos de orçamento em PDF</p>
                        </div>

                        <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-green-400 transition-colors duration-300">
                            <div class="flex justify-center mb-4">
                                <i data-lucide="upload-cloud" class="w-12 h-12 text-gray-400"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-700">Arraste e solte seu PDF aqui</h3>
                            <p class="text-gray-500 mt-1 mb-3">ou</p>
                            <label for="pdf-upload" class="cursor-pointer bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-400 transition shadow-sm">
                                <i data-lucide="upload" class="w-4 h-4 mr-2 inline"></i>
                                Selecione um arquivo
                                <input id="pdf-upload" type="file" accept=".pdf" class="hidden">
                            </label>
                            <p class="text-xs text-gray-500 mt-2">Somente arquivos PDF são aceitos (máx. 10MB)</p>
                        </div>

                        <div class="mt-8">
                            <h3 class="text-lg font-medium text-gray-800 mb-3">Modelos disponíveis</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="pdf-templates-list">
                                <!-- Templates will be listed here -->
                            </div>
                        </div>
                    </div>
                </main>

                <!-- Test Bot -->
                <main id="test-bot" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Testar Bot</h2>
                            <p class="text-gray-600 mt-1">Simule uma conversa com o bot do WhatsApp para testar as respostas</p>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0">
                                    <div class="flex items-center justify-center bg-[#25D366] rounded-full w-8 h-8">
                                        <i data-lucide="bot" class="text-white w-4 h-4"></i>
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-gray-800">Olá! Eu sou o assistente virtual da Budget IA. Como posso te ajudar hoje?</p>
                                </div>
                            </div>
                        </div>
                        
                        <div id="chat-messages" class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                            <!-- Messages will appear here -->
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <input type="text" id="message-input" placeholder="Digite sua mensagem..." class="flex-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                            <button onclick="sendMessage()" class="flex items-center justify-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[#25D366] hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </main>

                <!-- AI Settings / Company Settings -->
                <main id="ai-settings" class="hidden max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                    <div class="space-y-6">
                        <!-- Company Information -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="mb-6">
                                <h2 class="text-xl font-semibold text-gray-800">Informações da Empresa</h2>
                                <p class="text-gray-600 mt-1">Configure os dados da sua empresa que aparecerão nos orçamentos</p>
                            </div>
                            
                            <form class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="company-name" class="block text-sm font-medium text-gray-700">Nome da empresa *</label>
                                        <input type="text" id="company-name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                                    </div>
                                    
                                    <div>
                                        <label for="company-cnpj" class="block text-sm font-medium text-gray-700">CNPJ</label>
                                        <input type="text" id="company-cnpj" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition" placeholder="00.000.000/0000-00">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="company-address" class="block text-sm font-medium text-gray-700">Endereço completo</label>
                                    <textarea id="company-address" rows="2" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition"></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="company-email" class="block text-sm font-medium text-gray-700">E-mail</label>
                                        <input type="email" id="company-email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                                    </div>
                                    
                                    <div>
                                        <label for="company-phone" class="block text-sm font-medium text-gray-700">Telefone</label>
                                        <input type="tel" id="company-phone" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="company-website" class="block text-sm font-medium text-gray-700">Website</label>
                                    <input type="url" id="company-website" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition" placeholder="https://www.exemplo.com">
                                </div>
                                
                                <div class="flex justify-end">
                                    <button type="button" onclick="saveCompanyInfo()" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[#25D366] hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                        <i data-lucide="save" class="w-4 h-4 mr-2 inline"></i>
                                        Salvar informações
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Bot Configuration -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="mb-6">
                                <h2 class="text-xl font-semibold text-gray-800">Configuração do Bot</h2>
                                <p class="text-gray-600 mt-1">Configure o comportamento do bot de WhatsApp</p>
                            </div>
                            
                            <form class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Nível do bot</label>
                                    <div class="mt-2 space-y-2">
                                        <div class="flex items-center">
                                            <input id="basic-bot" name="bot-level" type="radio" checked class="focus:ring-[#25D366] h-4 w-4 text-[#25D366] border-gray-300">
                                            <label for="basic-bot" class="ml-2 block text-sm text-gray-700">
                                                Básico (respostas pré-definidas)
                                            </label>
                                        </div>
                                        <div class="flex items-center">
                                            <input id="intermediate-bot" name="bot-level" type="radio" class="focus:ring-[#25D366] h-4 w-4 text-[#25D366] border-gray-300">
                                            <label for="intermediate-bot" class="ml-2 block text-sm text-gray-700">
                                                Intermediário (respostas dinâmicas simples)
                                            </label>
                                        </div>
                                        <div class="flex items-center">
                                            <input id="ai-bot" name="bot-level" type="radio" class="focus:ring-[#25D366] h-4 w-4 text-[#25D366] border-gray-300">
                                            <label for="ai-bot" class="ml-2 block text-sm text-gray-700">
                                                IA Completa (ChatGPT avançado)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="welcome-message" class="block text-sm font-medium text-gray-700">Mensagem de boas-vindas</label>
                                    <textarea id="welcome-message" rows="3" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition">Olá! Eu sou o assistente virtual da Budget IA. Como posso te ajudar hoje?</textarea>
                                </div>
                                
                                <div>
                                    <label for="business-info" class="block text-sm font-medium text-gray-700">Informações sobre os serviços</label>
                                    <textarea id="business-info" rows="3" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none transition" placeholder="Forneça detalhes sobre seus serviços, preços médios, formas de pagamento, etc. para ajudar o bot a responder melhor."></textarea>
                                </div>
                                
                                <div class="flex justify-end">
                                    <button type="button" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-[#25D366] hover:bg-[#20C05A] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#25D366]">
                                        <i data-lucide="save" class="w-4 h-4 mr-2 inline"></i>
                                        Salvar configurações
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        // Store global variables
        let uploadedPDFTemplate = null;
        let generatedPDFData = null;
        let currentServices = [];
        let selectedBudgetServices = [];
        let companyInfo = {
            name: '',
            cnpj: '',
            address: '',
            email: '',
            phone: '',
            website: ''
        };

        // Sample budget data for demonstration
        const sampleBudgets = {
            1: {
                id: 1,
                client: 'Cliente A',
                clientPhone: '11999999999',
                clientEmail: 'clientea@email.com',
                clientAddress: 'Rua das Flores, 123 - São Paulo, SP',
                date: '2024-01-15',
                services: [
                    { name: 'Consultoria Estratégica', quantity: 10, unit: 'horas', unitValue: 120, total: 1200 }
                ],
                total: 1200,
                validity: '2024-01-25',
                notes: 'Projeto de consultoria para reestruturação organizacional',
                status: 'Aprovado'
            },
            2: {
                id: 2,
                client: 'Cliente B',
                clientPhone: '11888888888',
                clientEmail: 'clienteb@email.com',
                clientAddress: 'Av. Paulista, 456 - São Paulo, SP',
                date: '2024-01-14',
                services: [
                    { name: 'Design Gráfico', quantity: 5, unit: 'horas', unitValue: 80, total: 400 },
                    { name: 'Desenvolvimento Web', quantity: 15, unit: 'horas', unitValue: 100, total: 1500 }
                ],
                total: 1900,
                validity: '2024-01-24',
                notes: 'Desenvolvimento de site institucional',
                status: 'Pendente'
            },
            3: {
                id: 3,
                client: 'Cliente C',
                clientPhone: '11777777777',
                clientEmail: 'clientec@email.com',
                clientAddress: 'Rua da Consolação, 789 - São Paulo, SP',
                date: '2024-01-13',
                services: [
                    { name: 'Marketing Digital', quantity: 1, unit: 'projeto', unitValue: 2500, total: 2500 }
                ],
                total: 2500,
                validity: '2024-01-23',
                notes: 'Campanha de marketing digital para lançamento de produto',
                status: 'Recusado'
            }
        };

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            particlesJS('particles-js', {
                particles: {
                    number: { 
                        value: 100,
                        density: { 
                            enable: true, 
                            value_area: 1000 
                        } 
                    },
                    color: { 
                        value: ["#10b981", "#06b6d4", "#0ea5e9"] 
                    },
                    shape: { 
                        type: "circle",
                        stroke: {
                            width: 0,
                            color: "#000000"
                        }
                    },
                    opacity: {
                        value: 0.8,
                        random: true,
                        anim: {
                            enable: true,
                            speed: 1,
                            opacity_min: 0.1,
                            sync: false
                        }
                    },
                    size: {
                        value: 3,
                        random: true,
                        anim: {
                            enable: true,
                            speed: 2,
                            size_min: 0.1,
                            sync: false
                        }
                    },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#10b981",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 1,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false,
                        attract: {
                            enable: true,
                            rotateX: 600,
                            rotateY: 1200
                        }
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });
            
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Setup file upload
            setupFileUpload();

            // Load sample services
            loadSampleServices();

            // Load sample company info
            loadSampleCompanyInfo();
        });

        function loadSampleServices() {
            currentServices = [
                {
                    id: 1,
                    name: 'Consultoria Estratégica',
                    description: 'Consultoria especializada em estratégia empresarial',
                    priceType: 'por hora',
                    price: 120
                },
                {
                    id: 2,
                    name: 'Design Gráfico',
                    description: 'Criação de identidade visual e materiais gráficos',
                    priceType: 'por hora',
                    price: 80
                },
                {
                    id: 3,
                    name: 'Desenvolvimento Web',
                    description: 'Desenvolvimento de sites e aplicações web',
                    priceType: 'por hora',
                    price: 100
                },
                {
                    id: 4,
                    name: 'Marketing Digital',
                    description: 'Estratégias e campanhas de marketing online',
                    priceType: 'valor fixo',
                    price: 2500
                }
            ];
        }

        function loadSampleCompanyInfo() {
            companyInfo = {
                name: 'Budget IA Solutions',
                cnpj: '12.345.678/0001-90',
                address: 'Rua da Tecnologia, 100 - Sala 501\nVila Olímpia - São Paulo, SP\nCEP: 04551-000',
                email: 'contato@budgetia.com',
                phone: '(11) 3456-7890',
                website: 'https://www.budgetia.com'
            };

            // Populate form fields
            document.getElementById('company-name').value = companyInfo.name;
            document.getElementById('company-cnpj').value = companyInfo.cnpj;
            document.getElementById('company-address').value = companyInfo.address;
            document.getElementById('company-email').value = companyInfo.email;
            document.getElementById('company-phone').value = companyInfo.phone;
            document.getElementById('company-website').value = companyInfo.website;
        }
        
        // Navigation functions
        function showLogin() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('forgot-password-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }
        
        function showForgotPassword() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('forgot-password-screen').classList.remove('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }
        
        function showRegister() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('forgot-password-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }
        
        function showDashboard() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('forgot-password-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            showDashboardHome();
        }
        
        function showDashboardHome() {
            hideAllMainSections();
            document.getElementById('dashboard-home').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Dashboard';
            updateActiveNavItem('home');
        }
        
        function showConnectWhatsApp() {
            hideAllMainSections();
            document.getElementById('connect-whatsapp').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Conectar WhatsApp';
            updateActiveNavItem('whatsapp');
        }
        
        function showGenerateBudget() {
            hideAllMainSections();
            document.getElementById('generate-budget').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Gerar Orçamento';
            updateActiveNavItem('budget');
        }
        
        function showServicesManagement() {
            hideAllMainSections();
            document.getElementById('services-management').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Gerenciar Serviços';
            updateActiveNavItem('services');
            updateServicesDisplay();
        }
        
        function showPDFTemplates() {
            hideAllMainSections();
            document.getElementById('pdf-templates').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Modelos de PDF';
            updateActiveNavItem('pdf');
        }
        
        function showTestBot() {
            hideAllMainSections();
            document.getElementById('test-bot').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Testar Bot';
            updateActiveNavItem('test');
        }
        
        function showAISettings() {
            hideAllMainSections();
            document.getElementById('ai-settings').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Configurações';
            updateActiveNavItem('settings');
        }

        function showBudgetDetail() {
            hideAllMainSections();
            document.getElementById('budget-detail').classList.remove('hidden');
            document.getElementById('dashboard-title').textContent = 'Detalhes do Orçamento';
        }
        
        function hideAllMainSections() {
            const sections = ['dashboard-home', 'connect-whatsapp', 'generate-budget', 'services-management', 'pdf-templates', 'test-bot', 'ai-settings', 'budget-detail'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }
        
        function updateActiveNavItem(activeItem) {
            // Reset all items
            const navItems = document.querySelectorAll('.sidebar-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Set active item
            const pageMap = {
                'home': 0,
                'whatsapp': 1,
                'budget': 2,
                'services': 3,
                'pdf': 4,
                'test': 5,
                'settings': 6
            };
            
            if (pageMap[activeItem] !== undefined) {
                navItems[pageMap[activeItem]].classList.add('active');
            }
        }

        // Budget Detail View Functions
        function viewBudgetDetail(budgetId) {
            const budget = sampleBudgets[budgetId];
            if (!budget) return;

            showBudgetDetail();
            populateBudgetDetail(budget);
        }

        function populateBudgetDetail(budget) {
            const content = document.getElementById('budget-detail-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Informações do Cliente</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Nome</p>
                                <p class="font-medium">${budget.client}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">WhatsApp</p>
                                <p class="font-medium">+55 ${budget.clientPhone}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">E-mail</p>
                                <p class="font-medium">${budget.clientEmail}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Data do Orçamento</p>
                                <p class="font-medium">${new Date(budget.date).toLocaleDateString('pt-BR')}</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">Endereço</p>
                            <p class="font-medium">${budget.clientAddress}</p>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Status e Validade</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Status</p>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                                    budget.status === 'Aprovado' ? 'bg-green-100 text-green-800' :
                                    budget.status === 'Pendente' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-red-100 text-red-800'
                                }">${budget.status}</span>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Validade</p>
                                <p class="font-medium">${new Date(budget.validity).toLocaleDateString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Serviços</h3>
                        <div class="space-y-3">
                            ${budget.services.map(service => `
                                <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                                    <div>
                                        <p class="font-medium">${service.name}</p>
                                        <p class="text-sm text-gray-600">${service.quantity} ${service.unit} × R$ ${service.unitValue.toFixed(2)}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">R$ ${service.total.toFixed(2)}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="border-t pt-3 mt-3">
                            <div class="flex justify-between items-center">
                                <p class="text-lg font-semibold">Total</p>
                                <p class="text-lg font-semibold text-green-600">R$ ${budget.total.toFixed(2)}</p>
                            </div>
                        </div>
                    </div>

                    ${budget.notes ? `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="text-lg font-medium text-gray-800 mb-3">Observações</h3>
                            <p class="text-gray-700">${budget.notes}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function viewBudgetPDF() {
            alert('Funcionalidade de visualização de PDF em desenvolvimento. O PDF seria exibido aqui.');
        }

        // Service Selection Functions
        function openServiceSelector() {
            document.getElementById('service-selector-modal').classList.remove('hidden');
            populateServiceSelector();
        }

        function closeServiceSelector() {
            document.getElementById('service-selector-modal').classList.add('hidden');
        }

        function populateServiceSelector() {
            const container = document.getElementById('service-selector-list');
            container.innerHTML = currentServices.map(service => `
                <div class="service-option border rounded-lg p-3 hover:bg-gray-50 cursor-pointer" data-service-id="${service.id}">
                    <div class="flex items-center">
                        <input type="checkbox" class="service-checkbox mr-3" data-service-id="${service.id}">
                        <div class="flex-1">
                            <h4 class="font-medium">${service.name}</h4>
                            <p class="text-sm text-gray-500">${service.description}</p>
                            <p class="text-sm text-green-600">R$ ${service.price.toFixed(2)} (${service.priceType})</p>
                        </div>
                    </div>
                </div>
            `).join('');

            // Add click handlers
            container.querySelectorAll('.service-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = this.querySelector('.service-checkbox');
                        checkbox.checked = !checkbox.checked;
                    }
                });
            });
        }

        function addSelectedServices() {
            const selectedCheckboxes = document.querySelectorAll('.service-checkbox:checked');
            selectedCheckboxes.forEach(checkbox => {
                const serviceId = parseInt(checkbox.dataset.serviceId);
                const service = currentServices.find(s => s.id === serviceId);
                if (service && !selectedBudgetServices.find(s => s.id === serviceId)) {
                    selectedBudgetServices.push({
                        ...service,
                        quantity: 1
                    });
                }
            });
            
            updateSelectedServicesDisplay();
            closeServiceSelector();
        }

        function updateSelectedServicesDisplay() {
            const container = document.getElementById('selected-services-container');
            if (selectedBudgetServices.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">Nenhum serviço selecionado</p>';
                return;
            }

            container.innerHTML = selectedBudgetServices.map(service => `
                <div class="service-item bg-gray-50 p-3 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-medium">${service.name}</h4>
                        <button onclick="removeSelectedService(${service.id})" class="text-red-500 hover:text-red-700">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${service.description}</p>
                    <div class="flex items-center space-x-3">
                        <div class="flex-1">
                            <label class="block text-xs text-gray-600">Quantidade (${service.priceType.replace('por ', '')})</label>
                            <input type="number" min="1" value="${service.quantity}" 
                                   onchange="updateServiceQuantity(${service.id}, this.value)"
                                   class="mt-1 block w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-[#25D366] focus:border-[#25D366] outline-none">
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-600">Valor unitário</p>
                            <p class="font-medium">R$ ${service.price.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-600">Total</p>
                            <p class="font-medium text-green-600">R$ ${(service.price * service.quantity).toFixed(2)}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function updateServiceQuantity(serviceId, quantity) {
            const service = selectedBudgetServices.find(s => s.id === serviceId);
            if (service) {
                service.quantity = parseInt(quantity) || 1;
                updateSelectedServicesDisplay();
            }
        }

        function removeSelectedService(serviceId) {
            selectedBudgetServices = selectedBudgetServices.filter(s => s.id !== serviceId);
            updateSelectedServicesDisplay();
        }

        // File Upload Setup
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('pdf-upload');

            // Drag and drop handlers
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });

            // File input handler
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        function handleFileUpload(file) {
            if (file.type !== 'application/pdf') {
                alert('Por favor, selecione apenas arquivos PDF.');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                alert('O arquivo é muito grande. O tamanho máximo é 10MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedPDFTemplate = e.target.result;
                addTemplateToList(file.name, file.size);
                showUploadSuccess(file.name);
            };
            reader.readAsArrayBuffer(file);
        }

        function addTemplateToList(fileName, fileSize) {
            const templatesList = document.getElementById('pdf-templates-list');
            const template = document.createElement('div');
            template.className = 'border rounded-lg p-4 hover:shadow-md transition bg-green-50 border-green-200';
            template.innerHTML = `
                <div class="flex items-center mb-3">
                    <i data-lucide="file-text" class="w-6 h-6 text-green-600 mr-2"></i>
                    <div class="flex-1">
                        <span class="font-medium text-gray-800">${fileName}</span>
                        <p class="text-xs text-gray-500">${(fileSize / 1024).toFixed(1)} KB</p>
                    </div>
                    <div class="flex items-center">
                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Ativo</span>
                    </div>
                </div>
                <div class="flex justify-between">
                    <button onclick="previewTemplate('${fileName}')" class="text-sm text-blue-500 hover:underline">
                        <i data-lucide="eye" class="w-3 h-3 mr-1 inline"></i>
                        Visualizar
                    </button>
                    <button onclick="removeTemplate(this)" class="text-sm text-red-500 hover:underline">
                        <i data-lucide="trash-2" class="w-3 h-3 mr-1 inline"></i>
                        Remover
                    </button>
                </div>
            `;
            
            // Remove existing templates first (only one active at a time)
            templatesList.innerHTML = '';
            templatesList.appendChild(template);
            lucide.createIcons();
        }

        function showUploadSuccess(fileName) {
            // Create a temporary success message
            const uploadArea = document.getElementById('upload-area');
            const originalContent = uploadArea.innerHTML;
            
            uploadArea.innerHTML = `
                <div class="flex justify-center mb-4">
                    <i data-lucide="check-circle" class="w-12 h-12 text-green-500"></i>
                </div>
                <h3 class="text-lg font-medium text-green-700">Upload realizado com sucesso!</h3>
                <p class="text-green-600 mt-1 mb-3">${fileName} foi carregado e está pronto para uso</p>
            `;
            
            // Restore original content after 3 seconds
            setTimeout(() => {
                uploadArea.innerHTML = originalContent;
                lucide.createIcons();
                setupFileUpload();
            }, 3000);
        }

        function previewTemplate(fileName) {
            alert(`Visualizando template: ${fileName}\n\nFuncionalidade de visualização em desenvolvimento.`);
        }

        function removeTemplate(button) {
            if (confirm('Tem certeza que deseja remover este template?')) {
                uploadedPDFTemplate = null;
                button.closest('.border').remove();
            }
        }

        // Services Management
        function openNewServiceModal() {
            document.getElementById('new-service-modal').classList.remove('hidden');
        }

        function closeNewServiceModal() {
            document.getElementById('new-service-modal').classList.add('hidden');
            document.getElementById('service-form').reset();
        }

        function saveService() {
            const name = document.getElementById('service-name').value;
            const description = document.getElementById('service-description').value;
            const priceType = document.getElementById('service-price-type').value;
            const price = document.getElementById('service-price').value;
            
            if (!name || !price) {
                alert('Por favor, preencha os campos obrigatórios.');
                return;
            }
            
            const service = {
                id: Date.now(),
                name,
                description,
                priceType,
                price: parseFloat(price)
            };
            
            currentServices.push(service);
            updateServicesDisplay();
            closeNewServiceModal();
        }

        function updateServicesDisplay() {
            const servicesList = document.getElementById('services-list');
            const emptyState = document.getElementById('services-empty-state');
            
            if (currentServices.length === 0) {
                servicesList.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                servicesList.innerHTML = currentServices.map(service => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${service.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${service.description || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${service.priceType}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">R$ ${service.price.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="editService(${service.id})" class="text-blue-500 hover:text-blue-700 mr-2">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteService(${service.id})" class="text-red-500 hover:text-red-700">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                lucide.createIcons();
            }
        }

        function editService(id) {
            const service = currentServices.find(s => s.id === id);
            if (service) {
                document.getElementById('service-name').value = service.name;
                document.getElementById('service-description').value = service.description;
                document.getElementById('service-price-type').value = service.priceType;
                document.getElementById('service-price').value = service.price;
                
                // Remove the old service and open modal for editing
                deleteService(id);
                openNewServiceModal();
            }
        }

        function deleteService(id) {
            if (confirm('Tem certeza que deseja excluir este serviço?')) {
                currentServices = currentServices.filter(s => s.id !== id);
                updateServicesDisplay();
            }
        }

        // Company Information
        function saveCompanyInfo() {
            companyInfo = {
                name: document.getElementById('company-name').value,
                cnpj: document.getElementById('company-cnpj').value,
                address: document.getElementById('company-address').value,
                email: document.getElementById('company-email').value,
                phone: document.getElementById('company-phone').value,
                website: document.getElementById('company-website').value
            };
            
            alert('Informações da empresa salvas com sucesso!');
        }

        // PDF Generation functions
        async function generatePDF() {
            try {
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                const clientEmail = document.getElementById('client-email').value;
                const clientAddress = document.getElementById('client-address').value;
                let expiration = document.getElementById('expiration').value;
                const notes = document.getElementById('notes').value;

                if (!clientName) {
                    alert('Por favor, preencha o nome do cliente.');
                    return;
                }

                if (selectedBudgetServices.length === 0) {
                    alert('Por favor, selecione pelo menos um serviço.');
                    return;
                }

                // Auto-set expiration to 10 days if not provided
                if (!expiration) {
                    const futureDate = new Date();
                    futureDate.setDate(futureDate.getDate() + 10);
                    expiration = futureDate.toISOString().split('T')[0];
                    document.getElementById('expiration').value = expiration;
                }

                // Calculate total
                const total = selectedBudgetServices.reduce((sum, service) => sum + (service.price * service.quantity), 0);

                const clientInfo = {
                    name: clientName,
                    phone: clientPhone,
                    email: clientEmail,
                    address: clientAddress
                };

                if (uploadedPDFTemplate) {
                    // Use PDF-lib to modify existing template
                    generatedPDFData = await generatePDFWithTemplate(clientInfo, selectedBudgetServices, total, expiration, notes);
                } else {
                    // Generate new PDF with jsPDF
                    generatedPDFData = await generateBasicPDF(clientInfo, selectedBudgetServices, total, expiration, notes);
                }

                alert('PDF gerado com sucesso! Use os botões "Baixar PDF" ou "Compartilhar PDF" para acessar o arquivo.');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF. Tente novamente.');
            }
        }

        async function generatePDFWithTemplate(clientInfo, services, total, expiration, notes) {
            try {
                const existingPdfBytes = uploadedPDFTemplate;
                const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
                const pages = pdfDoc.getPages();
                const firstPage = pages[0];
                const { width, height } = firstPage.getSize();

                // Add client information
                firstPage.drawText(`Cliente: ${clientInfo.name}`, {
                    x: 50,
                    y: height - 150,
                    size: 12,
                    color: PDFLib.rgb(0, 0, 0),
                });

                if (clientInfo.phone) {
                    firstPage.drawText(`WhatsApp: +55 ${clientInfo.phone}`, {
                        x: 50,
                        y: height - 170,
                        size: 10,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                }

                if (clientInfo.email) {
                    firstPage.drawText(`E-mail: ${clientInfo.email}`, {
                        x: 50,
                        y: height - 190,
                        size: 10,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                }

                firstPage.drawText(`Data: ${new Date().toLocaleDateString('pt-BR')}`, {
                    x: 50,
                    y: height - 210,
                    size: 10,
                    color: PDFLib.rgb(0, 0, 0),
                });

                // Add services
                let yPosition = height - 250;
                firstPage.drawText('SERVIÇOS:', {
                    x: 50,
                    y: yPosition,
                    size: 14,
                    color: PDFLib.rgb(0.1, 0.7, 0.5),
                });

                yPosition -= 25;
                services.forEach((service, index) => {
                    firstPage.drawText(`${index + 1}. ${service.name}`, {
                        x: 50,
                        y: yPosition,
                        size: 10,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                    
                    firstPage.drawText(`${service.quantity} ${service.priceType.replace('por ', '')} × R$ ${service.price.toFixed(2)}`, {
                        x: 50,
                        y: yPosition - 12,
                        size: 8,
                        color: PDFLib.rgb(0.5, 0.5, 0.5),
                    });
                    
                    firstPage.drawText(`R$ ${(service.price * service.quantity).toFixed(2)}`, {
                        x: width - 100,
                        y: yPosition,
                        size: 10,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                    
                    yPosition -= 30;
                });

                // Add total
                yPosition -= 10;
                firstPage.drawText(`TOTAL: R$ ${total.toFixed(2)}`, {
                    x: 50,
                    y: yPosition,
                    size: 16,
                    color: PDFLib.rgb(0.1, 0.7, 0.5),
                });

                if (expiration) {
                    yPosition -= 30;
                    firstPage.drawText(`Válido até: ${new Date(expiration).toLocaleDateString('pt-BR')}`, {
                        x: 50,
                        y: yPosition,
                        size: 10,
                        color: PDFLib.rgb(0.5, 0.5, 0.5),
                    });
                }

                if (notes) {
                    yPosition -= 30;
                    firstPage.drawText('Observações:', {
                        x: 50,
                        y: yPosition,
                        size: 12,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                    
                    yPosition -= 20;
                    firstPage.drawText(notes, {
                        x: 50,
                        y: yPosition,
                        size: 10,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                }

                return await pdfDoc.save();
            } catch (error) {
                console.error('Erro ao gerar PDF com template:', error);
                throw error;
            }
        }

        async function generateBasicPDF(clientInfo, services, total, expiration, notes) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header with company info
            doc.setFillColor(16, 185, 129);
            doc.rect(0, 0, 210, 50, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.text(companyInfo.name || 'Budget IA', 20, 25);
            
            doc.setFontSize(10);
            doc.text('Orçamento Automatizado', 20, 35);
            
            if (companyInfo.phone) {
                doc.text(companyInfo.phone, 20, 42);
            }
            
            // Company information on the right
            if (companyInfo.email) {
                doc.text(companyInfo.email, 120, 35);
            }
            if (companyInfo.website) {
                doc.text(companyInfo.website, 120, 42);
            }
            
            // Reset text color
            doc.setTextColor(0, 0, 0);
            
            // Company details
            let yPos = 65;
            if (companyInfo.address) {
                doc.setFontSize(8);
                const addressLines = companyInfo.address.split('\n');
                addressLines.forEach(line => {
                    doc.text(line, 20, yPos);
                    yPos += 4;
                });
            }
            
            if (companyInfo.cnpj) {
                doc.text(`CNPJ: ${companyInfo.cnpj}`, 20, yPos);
                yPos += 8;
            }
            
            // Client info
            yPos += 10;
            doc.setFontSize(16);
            doc.text('DADOS DO CLIENTE', 20, yPos);
            yPos += 10;
            
            doc.setFontSize(12);
            doc.text(`Nome: ${clientInfo.name}`, 20, yPos);
            yPos += 6;
            
            if (clientInfo.phone) {
                doc.text(`WhatsApp: +55 ${clientInfo.phone}`, 20, yPos);
                yPos += 6;
            }
            
            if (clientInfo.email) {
                doc.text(`E-mail: ${clientInfo.email}`, 20, yPos);
                yPos += 6;
            }
            
            if (clientInfo.address) {
                doc.text(`Endereço: ${clientInfo.address}`, 20, yPos);
                yPos += 6;
            }
            
            doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 20, yPos);
            yPos += 15;
            
            // Services
            doc.setFontSize(16);
            doc.text('SERVIÇOS', 20, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            services.forEach((service, index) => {
                doc.text(`${index + 1}. ${service.name}`, 20, yPos);
                doc.text(`${service.quantity} ${service.priceType.replace('por ', '')} × R$ ${service.price.toFixed(2)}`, 20, yPos + 4);
                doc.text(`R$ ${(service.price * service.quantity).toFixed(2)}`, 150, yPos, { align: 'right' });
                yPos += 12;
            });
            
            // Total
            yPos += 5;
            doc.setFontSize(16);
            doc.setTextColor(16, 185, 129);
            doc.text(`TOTAL: R$ ${total.toFixed(2)}`, 20, yPos);
            doc.setTextColor(0, 0, 0);
            
            // Additional info
            if (expiration) {
                yPos += 15;
                doc.setFontSize(10);
                doc.text(`Válido até: ${new Date(expiration).toLocaleDateString('pt-BR')}`, 20, yPos);
            }
            
            if (notes) {
                yPos += 15;
                doc.setFontSize(12);
                doc.text('Observações:', 20, yPos);
                yPos += 8;
                doc.setFontSize(10);
                const splitNotes = doc.splitTextToSize(notes, 170);
                doc.text(splitNotes, 20, yPos);
            }
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text('Gerado automaticamente pelo Budget IA', 20, 280);
            
            return doc.output('arraybuffer');
        }

        function downloadPDF() {
            if (!generatedPDFData) {
                alert('Por favor, gere um PDF primeiro.');
                return;
            }

            const blob = new Blob([generatedPDFData], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `orcamento_${document.getElementById('client-name').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function shareWhatsApp() {
            if (!generatedPDFData) {
                alert('Por favor, gere um PDF primeiro.');
                return;
            }

            const clientPhone = document.getElementById('client-phone').value;
            const clientName = document.getElementById('client-name').value;
            
            if (!clientPhone) {
                alert('Por favor, preencha o WhatsApp do cliente.');
                return;
            }

            // Create blob URL for PDF
            const blob = new Blob([generatedPDFData], { type: 'application/pdf' });
            const pdfUrl = URL.createObjectURL(blob);

            // Create WhatsApp message
            const message = `Olá ${clientName}! Segue o orçamento solicitado. Qualquer dúvida, estou à disposição!`;
            const whatsappUrl = `https://wa.me/55${clientPhone}?text=${encodeURIComponent(message)}`;

            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');

            // Show instruction to user
            setTimeout(() => {
                alert(`PDF gerado com sucesso!\n\nPara enviar o arquivo PDF:\n1. Cole o link no WhatsApp que acabou de abrir\n2. Ou baixe o PDF e envie como anexo\n\nLink do PDF: ${pdfUrl}`);
            }, 1000);
        }

        // Test Bot functions
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            
            const chatMessages = document.getElementById('chat-messages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'flex justify-end';
            userMessage.innerHTML = `
                <div class="max-w-xs md:max-w-md bg-[#25D366] text-white p-3 rounded-lg rounded-tr-none">
                    <p>${message}</p>
                </div>
            `;
            chatMessages.appendChild(userMessage);
            
            // Clear input
            input.value = '';
            
            // Add bot response after a short delay
            setTimeout(() => {
                const botResponse = document.createElement('div');
                botResponse.className = 'flex justify-start';
                
                // Simple bot responses based on keywords
                let responseText = '';
                if (message.toLowerCase().includes('orçamento') || message.toLowerCase().includes('preço')) {
                    responseText = 'Para gerar um orçamento, por favor informe os serviços que você precisa e eu prepararei uma proposta.';
                } else if (message.toLowerCase().includes('contato') || message.toLowerCase().includes('falar')) {
                    responseText = `Você pode falar diretamente conosco pelo telefone ${companyInfo.phone || '(11) 1234-5678'} ou pelo email ${companyInfo.email || 'contato@empresa.com'}`;
                } else if (message.toLowerCase().includes('horário') || message.toLowerCase().includes('funciona')) {
                    responseText = 'Nosso horário de atendimento é de segunda a sexta, das 9h às 18h.';
                } else {
                    responseText = 'Entendi sua mensagem. Como posso te ajudar com orçamentos ou informações sobre nossos serviços?';
                }
                
                botResponse.innerHTML = `
                    <div class="max-w-xs md:max-w-md bg-gray-100 text-gray-800 p-3 rounded-lg rounded-tl-none">
                        <p>${responseText}</p>
                    </div>
                `;
                chatMessages.appendChild(botResponse);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }
        
        // Allow sending message with Enter key
        document.getElementById('message-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
    
    <!-- Service Selector Modal -->
    <div id="service-selector-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-96 overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Selecionar Serviços</h3>
                <button onclick="closeServiceSelector()" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div id="service-selector-list" class="service-selector space-y-3 mb-6">
                <!-- Services will be populated here -->
            </div>
            
            <div class="flex justify-end space-x-3">
                <button onclick="closeServiceSelector()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition">
                    Cancelar
                </button>
                <button onclick="addSelectedServices()" class="px-4 py-2 bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-lg hover:opacity-90 transition">
                    <i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>
                    Adicionar Selecionados
                </button>
            </div>
        </div>
    </div>

    <!-- New Service Modal -->
    <div id="new-service-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Novo Serviço</h3>
                <button onclick="closeNewServiceModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <form id="service-form" class="space-y-4">
                <div>
                    <label for="service-name" class="block text-sm font-medium text-gray-700">Nome do serviço *</label>
                    <input type="text" id="service-name" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-green-400 outline-none transition" required>
                </div>
                
                <div>
                    <label for="service-description" class="block text-sm font-medium text-gray-700">Descrição</label>
                    <textarea id="service-description" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-green-400 outline-none transition" rows="2"></textarea>
                </div>
                
                <div>
                    <label for="service-price" class="block text-sm font-medium text-gray-700">Valor *</label>
                    <input type="number" id="service-price" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-green-400 outline-none transition" min="0" step="0.01" required>
                </div>
                
                <div>
                    <label for="service-price-type" class="block text-sm font-medium text-gray-700">Tipo de unidade *</label>
                    <select id="service-price-type" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-green-400 outline-none transition" required>
                        <option value="valor fixo">Valor Fixo</option>
                        <option value="por hora">Por Hora</option>
                        <option value="por metro quadrado">Por Metro Quadrado (m²)</option>
                        <option value="por centímetro">Por Centímetro (cm)</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeNewServiceModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition">
                        Cancelar
                    </button>
                    <button type="button" onclick="saveService()" class="px-4 py-2 bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-lg hover:opacity-90 transition">
                        <i data-lucide="save" class="w-4 h-4 mr-2 inline"></i>
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - 🧬 <a href="https://enzostvs-deepsite.hf.space?remix=FilipeGab/budget-ai" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p>
</body>
</html>
